@model CustomerDashboardViewModel
 
@{
    ViewBag.Title = "My Settings";
    Layout = "_Layout2";
    var i = -1;
    var j = 0;
}

<!-- Customer Profile -->
<section class="customerDetails">
    <div class="upcoming-service-details">
        <div class="container">
            <div id="upcoming-service-menu-table" class="d-flex">
                <div class="container-menu">
                    <div class="navbar">
                        <ul id="upcoming-service-menu" class="nav flex-column">
                            <li class="nav-item">
                                    <a class="nav-link" asp-action="CustomerDashboard" asp-controller="Customer">Dashboard</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" asp-action="CustomerServiceHistory" asp-controller="Customer">Service History</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Service Schedule</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Favourite Pros</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Invoices</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Notifications</a>
                                </li>
                        </ul>
                    </div>
                </div>
    
                <div class="container-details">
                    <div class="profile-options">
                        <ul class="nav nav-tabs nav-justified">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" aria-current="page" href="#MyDetails"
                                    id="MyDetails-tab">My Details</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" aria-current="page" href="#MyAddress"
                                    id="MyAddress-tab">My Address</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" aria-current="page" href="#ChangePassword"
                                id="ChangePassword-tab">Change Password</a>
                            </li>
                        </ul>
    
                        <!-- Tab Content -->
                        <div class="tab-content">
    
                            <!-- MyDetails-tab -->
                            <div class="tab-pane fade show active" id="MyDetails" role="tabpanel" aria-labelledby="MyDetails-tab">
                                <div class="row mb-4">
                                    <div class="col-sm-12 col-md-4 mb-3">
                                        <label class="form-label">First Name</label>
                                        <input asp-for="@Model.user.FirstName" class="form-control" placeholder="First name"
                                            aria-label="First name">
                                    </div>
                                    <div class="col-sm-12 col-md-4 mb-3">
                                        <label class="form-label">Last Name</label>
                                        <input asp-for="@Model.user.LastName" class="form-control" placeholder="Last name"
                                            aria-label="Last name">
                                    </div>
                                    <div class="col-sm-12 col-md-4 mb-3">
                                        <label class="form-label">E-mail address</label>
                                        <input asp-for="@Model.user.Email" readonly class="form-control"
                                            aria-label="Last name">
                                    </div>
                                    <div class="col-sm-12 col-md-4 mb-3">
                                        <label class="form-label">Mobile Number</label>
                                        <div class="input-group">
                                            <div class="input-group-text">+91</div>
                                            <input asp-for="@Model.user.Mobile" class="form-control" placeholder="Mobile Number">
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-4 mb-3">
                                        <label class="form-label">Date of Birth</label>
                                        <div class="dob-group">
                                            <div class="dob">
                                                <select asp-for="@Model.Day" class="form-select" aria-label="Default select example">
                                                    <option selected>Day</option>
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                    <option value="9">9</option>
                                                    <option value="10">10</option>
                                                    <option value="11">11</option>
                                                    <option value="12">12</option>
                                                    <option value="13">13</option>
                                                    <option value="14">14</option>
                                                    <option value="15">15</option>
                                                    <option value="16">16</option>
                                                    <option value="17">17</option>
                                                    <option value="18">18</option>
                                                    <option value="19">19</option>
                                                    <option value="20">20</option>
                                                    <option value="21">21</option>
                                                    <option value="22">22</option>
                                                    <option value="23">23</option>
                                                    <option value="24">24</option>
                                                    <option value="25">25</option>
                                                    <option value="26">26</option>
                                                    <option value="27">27</option>
                                                    <option value="28">28</option>
                                                    <option value="29">29</option>
                                                    <option value="30">30</option>
                                                    <option value="31">31</option>
                                                </select>
                                            </div>
                                            <div class="dob">
                                                <select asp-for="@Model.Month" class="form-select">
                                                    <option selected>Month</option>
                                                    <option value="1">January</option>
                                                    <option value="2">February</option>
                                                    <option value="3">March</option>
                                                    <option value="4">April</option>
                                                    <option value="5">May</option>
                                                    <option value="6">June</option>
                                                    <option value="7">July</option>
                                                    <option value="8">August</option>
                                                    <option value="9">September</option>
                                                    <option value="10">October</option>
                                                    <option value="11">November</option>
                                                    <option value="12">December</option>
                                                </select>
                                            </div>
                                            <div class="dob">
                                                <select asp-for="@Model.Year" class="form-select" aria-label="Default select example">
                                                    <option selected>Year</option>
                                                    <option value="2010">2012</option>
                                                    <option value="2011">2011</option>
                                                    <option value="2010">2010</option>
                                                    <option value="2009">2009</option>
                                                    <option value="2008">2008</option>
                                                    <option value="2007">2007</option>
                                                    <option value="2006">2006</option>
                                                    <option value="2005">2005</option>
                                                    <option value="2004">2004</option>
                                                    <option value="2003">2003</option>
                                                    <option value="2002">2002</option>
                                                    <option value="2001">2001</option>
                                                    <option value="2000">2000</option>
                                                    <option value="1999">1999</option>
                                                    <option value="1998">1998</option>
                                                    <option value="1997">1997</option>
                                                    <option value="1996">1996</option>
                                                    <option value="1995">1995</option>
                                                    <option value="19940">1994</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="mb-4">
                                    <label class="form-label">My Preferred Language</label>
                                    <select id="Language" class="form-select" aria-label="Default select example">
                                        <option value="1">English</option>
                                        <option value="2">Gujarati</option>
                                    </select>
                                </div>
                                <button type="button" id="SaveButon" class="save-btn">Save</button>
                            </div>
    
                            <!-- MyAddress-tab -->
                            <div class="tab-pane fade" id="MyAddress" role="tabpanel"
                                aria-labelledby="MyAddress-tab">
                                <div class="msg"></div>
                                <table class="mt-4 mb-4">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Invoicing</th>
                                            <th>Addresses</th>
                                            <th class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.Address != null)
                                        {
                                            @foreach (var x in Model.Address)
                                            {
                                                i += 1;
                                                <tr>
                                                    <td class="text-center">
                                                        <div class="radio-btn">
                                                            <label>
                                                                <input id="radio_@i" type="radio" name="invoice-address">
                                                                <span></span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="invoices">
                                                            <span class="address-1"><b>Address: </b>@x.AddressLine1 @x.AddressLine2, 
                                                                @x.PostalCode @x.City</span>
                                                            <span><b>Phone number:</b> @x.Mobile</span>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="action-btn">
                                                            <a data-bs-toggle="modal" data-bs-target="#EditAddress" class="edit">
                                                                <img src="~/image/edit-icon.png" name="@i" id="edit_@x.AddressId">
                                                            </a>
                                                            <a data-bs-toggle="modal" data-bs-target="#DeleteAddress" class="delete">
                                                                <img src="~/image/delete-icon.png" id="delete_@x.AddressId">
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>

                                <div class="d-flex justify-content-between">
                                    <a data-bs-toggle="modal" data-bs-target="#AddAddressInvoice">
                                        <button class="add-address-btn">Add New Adderess</button>
                                    </a>
                                    <div class="show-more">
                                        <span class="me-2">5 of 20</span>
                                        <button class="show-more-btn">Show More</button>
                                    </div>
                                </div>

                                <div class="modal fade" id="AddAddressInvoice" data-bs-backdrop="static">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <h4>Add New Address</h4>
                                                <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close">
                                                    <img src="~/image/close.png">
                                                </button>
                                    
                                                <form class="mb-0">
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Street name</label>
                                                                <input asp-for="@Model.add.AddressLine1" class="form-control" placeholder="Street name">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">House number</label>
                                                                <input asp-for="@Model.add.AddressLine2"class="form-control" placeholder="House number">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Postal code</label>
                                                                <input asp-for="@Model.add.PostalCode" class="form-control" placeholder="Postal Code">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">City</label>
                                                                <input asp-for="@Model.add.City" class="form-control" placeholder="City">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Phone number</label>
                                                                <div class="input-group">
                                                                    <div class="input-group-text">+91</div>
                                                                    <input asp-for="@Model.add.Mobile" class="form-control" placeholder="Phone number">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row justify-content-center">
                                                        <div class="col-sm-6">
                                                            <button type="button" id="addAddress" class="submit-btn save">Add</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal fade" id="DeleteAddress" data-bs-backdrop="static">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <h4>Delete Address</h4>
                                                <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close">
                                                    <img src="~/image/close.png">
                                                </button>
                                                <p>Are you sure you want to delete this address?</p>
                                                <button type="button" id="DeAddress" class="blue">Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal fade" id="EditAddress" data-bs-backdrop="static">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <h4>Add New Address</h4>
                                                <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close">
                                                    <img src="~/image/close.png">
                                                </button>
                                                <form class="mb-0">
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Street name</label>
                                                                <input type="text" id="addressline1" class="form-control" placeholder="Street name">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">House number</label>
                                                                <input type="text" id="addressline2" class="form-control" placeholder="House number">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Postal code</label>
                                                                <input type="text" id="postalcode" class="form-control" placeholder="Postal Code">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">City</label>
                                                                <input type="text" id="city" class="form-control" placeholder="City">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Phone number</label>
                                                                <div class="input-group">
                                                                    <div class="input-group-text">+91</div>
                                                                    <input type="text" id="mobile" class="form-control" placeholder="Phone number">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row justify-content-center">
                                                        <div class="col-sm-6">
                                                            <button id="updateAddress" type="button" class="submit-btn save">Update</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ChanePassword-tab -->
                            <div class="tab-pane fade" id="ChangePassword" role="tabpanel"
                                aria-labelledby="ChangePassword-tab">
                                <div class="row mb-1 mt-3">
                                    <div class="col-sm-4">
                                        <label class="form-label">Old Password</label>
                                        <input asp-for="@Model.changePassword.old" class="form-control" placeholder="Current Password"
                                            aria-label="Current Password">
                                        <span asp-validation-for="@Model.changePassword.old" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="row mb-1 mt-3">
                                    <div class="col-sm-4">
                                        <label class="form-label">New Password</label>
                                        <input asp-for="@Model.changePassword.new1" class="form-control" placeholder="Password"
                                            aria-label="Password">
                                        <span asp-validation-for="@Model.changePassword.new1" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="row mb-1 mt-3 mb-3">
                                    <div class="col-sm-4">
                                        <label class="form-label">Confirm Password</label>
                                        <input asp-for="@Model.changePassword.confirm" class="form-control" placeholder="Confirm Password">
                                        <span asp-validation-for="@Model.changePassword.confirm" class="text-danger"></span>
                                    </div>
                                </div>
                                <button type="button" id="chpassword" class="pwd-save">Save</button>
                            </div>
    
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


@section Scripts{
    <script>
        $(document).ready(function(){
            $('#SaveButon').click(function(){
                let day = $('#@Html.IdFor(m => m.Day)').val();
                let month = $('#@Html.IdFor(m => m.Month)').val();
                let year = $('#@Html.IdFor(m => m.Year)').val();
                let s = year+"-"+month+"-"+day;
                let userModal = {
                    FirstName: $('#@Html.IdFor(m => m.user.FirstName)').val(),
                    LastName: $('#@Html.IdFor(m => m.user.LastName)').val(),
                    Mobile: $('#@Html.IdFor(m => m.user.Mobile)').val(),
                    DateOfBirth: s,
                    LanguageId: $('#Language').val()
                }
                console.log(userModal);
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("SaveDetails","Customer")',
                    data: userModal,
                    dataType: 'JSON',
                    success: function (response){
                        if(response.success)
                        {
                            location.reload(true);
                        }
                    }
                });
            });

            let aId = 0;
            let x = 0;
            $("[id^='edit_']").click(function(){
                var a = $(this).prop('id');
                console.log(a);
                aId = a.split('_')[1];
                x = $(this).attr('name');
                j = x;
                $('#addressline1').val('@Model.Address[j].AddressLine1');
                $('#addressline2').val('@Model.Address[j].AddressLine2');
                $('#postalcode').val('@Model.Address[j].PostalCode');
                $('#city').val('@Model.Address[j].City');
                $('#mobile').val('@Model.Address[j].Mobile');
            });

            $("[id^='delete_']").click(function(){
                var a = $(this).prop('id');
                console.log(a);
                aId = a.split('_')[1];
            });
            
            $('#updateAddress').click(function(){
                let addressModel = {
                    AddressId: aId,
                    AddressLine1: $('#addressline1').val(),
                    AddressLine2: $('#addressline2').val() ,
                    City: $('#city').val(),
                    PostalCode: $('#postalcode').val(),
                    Mobile: $('#mobile').val()
                }

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("UpdateAddress","Customer")',
                    data: addressModel,
                    dataType: 'JSON',
                    success: function (response){
                        if(response.success)
                        {
                            location.reload(true);
                        }
                    }
                });
            });

            $('#DeAddress').click(function(){
                let model ={
                    AddressId : aId
                }
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("DeleteAddress","Customer")',
                    data: model,
                    dataType: 'JSON',
                    success: function (response){
                        if(response.success)
                        {
                            $('#DeleteAddress').modal('hide');
                            location.reload(true);
                        }
                    }
                });
            });


            $('#addAddress').click(function(){
                let addressModel = {
                    AddressLine1: $('#@Html.IdFor(m=>m.add.AddressLine1)').val(),
                    AddressLine2: $('#@Html.IdFor(m=>m.add.AddressLine2)').val() ,
                    City: $('#@Html.IdFor(m=>m.add.City)').val(),
                    PostalCode: $('#@Html.IdFor(m=>m.add.PostalCode)').val(),
                    Mobile: $('#@Html.IdFor(m=>m.add.Mobile)').val()
                }
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("AddAddress","Customer")',
                    data: addressModel,
                    dataType: 'JSON',
                    success: function (response){
                        if(response.success)
                        {
                            $('#DeleteAddress').modal('hide');
                            location.reload(true);
                        }
                    }
                });
            });
            

            $('#chpassword').click(function(){
                let model ={
                    old: $('#@Html.IdFor(m=>m.changePassword.old)').val(),
                    new1: $('#@Html.IdFor(m=>m.changePassword.new1)').val(),
                    confirm: $('#@Html.IdFor(m=>m.changePassword.confirm)').val(),
                }
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("UpdatePassword","Customer")',
                    data: model,
                    dataType: 'JSON',
                    success: function (response){
                        if(response.success)
                        {
                            $('#DeleteAddress').modal('hide');
                            location.reload(true);
                        }
                        if(!response.success)
                        {
                            //for(var i=0;i<response.errors.length; i++)
                            //{
                            //    console.log(response.errors[i]);
                            //}
                        }
                    }
                });
            });



        });
    </script>
}